<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸”ë¡œê·¸ ë§í¬ ìˆ˜ì§‘ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 50%, #0d1b2a 100%);
            min-height: 100vh;
            padding: 30px 20px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 8px;
            font-size: 2.3rem;
            font-weight: 700;
        }

        .subtitle {
            color: rgba(255,255,255,0.6);
            text-align: center;
            margin-bottom: 30px;
            font-size: 0.95rem;
        }

        .card {
            background: rgba(255,255,255,0.98);
            border-radius: 20px;
            padding: 28px;
            margin-bottom: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: #1a1a2e;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .platform-badges {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .platform-badge {
            padding: 10px 20px;
            border-radius: 12px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 2px solid;
        }

        .platform-badge.naver { 
            background: #03c75a15; 
            color: #03c75a; 
            border-color: #03c75a40;
        }
        .platform-badge.tistory { 
            background: #eb531115; 
            color: #eb5311; 
            border-color: #eb531140;
        }
        .platform-badge.blogger { 
            background: #ff570015; 
            color: #ff5700; 
            border-color: #ff570040;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 16px;
        }

        input[type="text"] {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s;
            background: #f8fafc;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #6366f1;
            background: white;
            box-shadow: 0 0 0 4px rgba(99, 102, 241, 0.1);
        }

        button {
            padding: 15px 24px;
            border: none;
            border-radius: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(16, 185, 129, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #e2e8f0;
        }

        .btn-small {
            padding: 10px 16px;
            font-size: 0.85rem;
        }

        /* í”Œë«í¼ ê°ì§€ */
        .platform-detect {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 8px 16px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        /* ë””ë²„ê·¸ ë¡œê·¸ */
        .debug-section {
            margin-top: 20px;
            padding: 16px;
            background: #1e293b;
            border-radius: 12px;
            max-height: 200px;
            overflow-y: auto;
        }

        .debug-title {
            color: #94a3b8;
            font-size: 0.85rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .debug-log {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.8rem;
            color: #10b981;
            line-height: 1.6;
        }

        .debug-log .error {
            color: #ef4444;
        }

        .debug-log .warning {
            color: #f59e0b;
        }

        .debug-log .info {
            color: #3b82f6;
        }

        /* ì €ì¥ëœ ë¸”ë¡œê·¸ ê´€ë¦¬ */
        .blog-manager {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #e2e8f0;
        }

        .blog-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 16px;
            max-height: 300px;
            overflow-y: auto;
        }

        .blog-item {
            display: flex;
            align-items: center;
            padding: 14px 18px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
        }

        .blog-item:hover {
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
        }

        .blog-item-platform {
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-right: 14px;
        }

        .blog-item-platform.naver { background: #03c75a20; color: #03c75a; }
        .blog-item-platform.tistory { background: #eb531120; color: #eb5311; }
        .blog-item-platform.blogger { background: #ff570020; color: #ff5700; }

        .blog-item-info {
            flex: 1;
        }

        .blog-item-name {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 2px;
        }

        .blog-item-url {
            font-size: 0.85rem;
            color: #64748b;
        }

        .blog-item-actions {
            display: flex;
            gap: 8px;
        }

        .blog-item-actions button {
            padding: 8px 14px;
            font-size: 0.8rem;
        }

        /* í†µê³„ */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: #f8fafc;
            border-radius: 14px;
            padding: 20px;
            text-align: center;
            border: 2px solid #e2e8f0;
        }

        .stat-card.new {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-color: #a7f3d0;
        }

        .stat-card.submitted {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #93c5fd;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: #1e293b;
        }

        .stat-label {
            font-size: 0.85rem;
            color: #64748b;
            margin-top: 4px;
        }

        /* ì§„í–‰ ìƒíƒœ */
        .progress-section {
            display: none;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9rem;
            color: #64748b;
        }

        .progress-bar-container {
            background: #e2e8f0;
            border-radius: 20px;
            height: 16px;
            overflow: hidden;
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            border-radius: 20px;
            transition: width 0.3s;
            width: 0%;
            position: relative;
        }

        .progress-bar.collecting::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 1.5s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-status {
            font-size: 0.95rem;
            color: #6366f1;
            font-weight: 600;
            text-align: center;
        }

        /* í•„í„° íƒ­ */
        .filter-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 6px;
            background: #f1f5f9;
            border-radius: 14px;
            width: fit-content;
        }

        .filter-tab {
            padding: 10px 18px;
            border: none;
            background: transparent;
            font-size: 0.9rem;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
        }

        .filter-tab:hover {
            color: #475569;
        }

        .filter-tab.active {
            background: white;
            color: #6366f1;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .filter-count {
            background: #e2e8f0;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-left: 6px;
        }

        .filter-tab.active .filter-count {
            background: #6366f120;
            color: #6366f1;
        }

        /* ì•¡ì…˜ ë°” */
        .action-bar {
            display: flex;
            gap: 10px;
            padding: 16px;
            background: #f8fafc;
            border-radius: 14px;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
            border: 2px solid #e2e8f0;
        }

        .action-info {
            flex: 1;
            min-width: 200px;
            font-size: 0.95rem;
            color: #475569;
        }

        .action-info strong {
            color: #6366f1;
            font-weight: 700;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* ë§í¬ ì»¨í…Œì´ë„ˆ */
        .links-container {
            background: #f8fafc;
            border-radius: 14px;
            padding: 16px;
            max-height: 500px;
            overflow-y: auto;
            border: 2px solid #e2e8f0;
        }

        .link-item {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            background: white;
            border-radius: 10px;
            margin-bottom: 8px;
            border: 2px solid #e2e8f0;
            transition: all 0.2s;
        }

        .link-item:hover {
            border-color: #6366f1;
        }

        .link-item.submitted {
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);
            border-color: #93c5fd;
        }

        .link-item:last-child {
            margin-bottom: 0;
        }

        .link-number {
            background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
            color: white;
            min-width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.85rem;
            font-weight: 700;
            margin-right: 14px;
        }

        .link-item.submitted .link-number {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
        }

        .link-content {
            flex: 1;
            min-width: 0;
        }

        .link-url {
            font-size: 0.9rem;
            color: #334155;
            word-break: break-all;
        }

        .link-url a {
            color: #334155;
            text-decoration: none;
        }

        .link-url a:hover {
            color: #6366f1;
            text-decoration: underline;
        }

        .link-platform {
            font-size: 0.75rem;
            color: #94a3b8;
            margin-top: 4px;
        }

        .link-status {
            margin-left: 14px;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
        }

        .status-badge.new {
            background: #dcfce7;
            color: #166534;
        }

        .status-badge.submitted {
            background: #dbeafe;
            color: #1e40af;
        }

        /* í˜ì´ì§€ë„¤ì´ì…˜ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            margin-top: 24px;
        }

        .pagination button {
            width: 46px;
            height: 46px;
            padding: 0;
            font-size: 1.1rem;
        }

        .page-info {
            font-size: 0.95rem;
            color: #64748b;
            font-weight: 600;
            min-width: 100px;
            text-align: center;
        }

        /* í† ìŠ¤íŠ¸ */
        .toast {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: #1e293b;
            color: white;
            padding: 16px 32px;
            border-radius: 14px;
            font-size: 0.95rem;
            font-weight: 500;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 1000;
            box-shadow: 0 15px 50px rgba(0,0,0,0.3);
            max-width: 90%;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* ë¹ˆ ìƒíƒœ */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #94a3b8;
        }

        .empty-state svg {
            width: 70px;
            height: 70px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* ëª¨ë‹¬ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: white;
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            transform: scale(0.9);
            transition: all 0.3s;
        }

        .modal-overlay.show .modal {
            transform: scale(1);
        }

        .modal-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 20px;
        }

        .modal-input {
            margin-bottom: 16px;
        }

        .modal-input label {
            display: block;
            font-size: 0.9rem;
            font-weight: 600;
            color: #475569;
            margin-bottom: 8px;
        }

        .modal-input input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
        }

        .modal-input input:focus {
            outline: none;
            border-color: #6366f1;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            body {
                padding: 20px 15px;
            }

            h1 {
                font-size: 1.7rem;
            }

            .card {
                padding: 20px;
            }

            .platform-badges {
                flex-wrap: wrap;
            }

            .input-group {
                flex-direction: column;
            }

            .stats-container {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .stat-card {
                padding: 14px;
            }

            .stat-number {
                font-size: 1.5rem;
            }

            .filter-tabs {
                width: 100%;
                justify-content: center;
            }

            .action-bar {
                flex-direction: column;
            }

            .action-buttons {
                width: 100%;
                justify-content: center;
            }

            .blog-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 12px;
            }

            .blog-item-actions {
                width: 100%;
            }

            .blog-item-actions button {
                flex: 1;
            }

            .link-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .link-status {
                margin-left: 0;
                align-self: flex-end;
            }
        }

        /* ìŠ¤í¬ë¡¤ë°” */
        .links-container::-webkit-scrollbar,
        .blog-list::-webkit-scrollbar,
        .debug-section::-webkit-scrollbar {
            width: 8px;
        }

        .links-container::-webkit-scrollbar-track,
        .blog-list::-webkit-scrollbar-track,
        .debug-section::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 4px;
        }

        .links-container::-webkit-scrollbar-thumb,
        .blog-list::-webkit-scrollbar-thumb,
        .debug-section::-webkit-scrollbar-thumb {
            background: #94a3b8;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”— ë¸”ë¡œê·¸ ë§í¬ ìˆ˜ì§‘ê¸°</h1>
        <p class="subtitle">ë„¤ì´ë²„ ë¸”ë¡œê·¸ Â· í‹°ìŠ¤í† ë¦¬ Â· ë¸”ë¡œê·¸ìŠ¤íŒŸ ë§í¬ë¥¼ ì†ì‰½ê²Œ ìˆ˜ì§‘í•˜ì„¸ìš”</p>

        <!-- ë¸”ë¡œê·¸ ì£¼ì†Œ ì…ë ¥ -->
        <div class="card">
            <div class="section-title">ğŸ“ ë¸”ë¡œê·¸ ì£¼ì†Œ ì…ë ¥</div>
            
            <div class="platform-badges">
                <span class="platform-badge naver">ğŸŸ¢ ë„¤ì´ë²„ ë¸”ë¡œê·¸</span>
                <span class="platform-badge tistory">ğŸŸ  í‹°ìŠ¤í† ë¦¬</span>
                <span class="platform-badge blogger">ğŸŸ§ ë¸”ë¡œê·¸ìŠ¤íŒŸ</span>
            </div>

            <div class="input-group">
                <input type="text" id="blogUrl" placeholder="ë¸”ë¡œê·¸ ì£¼ì†Œ ì…ë ¥ (ì˜ˆ: blog.naver.com/blogid ë˜ëŠ” example.tistory.com)">
                <button class="btn-primary" onclick="addBlog()">â• ì¶”ê°€</button>
                <button class="btn-success" id="startBtn" onclick="startCollect()">ğŸš€ ìˆ˜ì§‘</button>
                <button class="btn-danger" id="stopBtn" onclick="stopCollect()" style="display: none;">â¹ ì •ì§€</button>
            </div>

            <div id="platformDetect"></div>

            <!-- ë””ë²„ê·¸ ë¡œê·¸ -->
            <div class="debug-section" id="debugSection" style="display: none;">
                <div class="debug-title">
                    <span>ğŸ” ìˆ˜ì§‘ ë¡œê·¸</span>
                    <button class="btn-secondary btn-small" onclick="clearDebugLog()" style="padding: 4px 10px; font-size: 0.75rem;">ì§€ìš°ê¸°</button>
                </div>
                <div class="debug-log" id="debugLog"></div>
            </div>

            <!-- ì €ì¥ëœ ë¸”ë¡œê·¸ ê´€ë¦¬ -->
            <div class="blog-manager" id="blogManager" style="display: none;">
                <div class="section-title">ğŸ’¾ ì €ì¥ëœ ë¸”ë¡œê·¸ ê´€ë¦¬</div>
                <div class="blog-list" id="blogList"></div>
            </div>
        </div>

        <!-- ì§„í–‰ ìƒíƒœ -->
        <div class="card progress-section" id="progressSection">
            <div class="progress-header">
                <div class="section-title" style="margin-bottom: 0;">â³ ìˆ˜ì§‘ ì§„í–‰ ì¤‘</div>
                <button class="btn-danger btn-small" onclick="stopCollect()">â¹ ì •ì§€</button>
            </div>
            <div class="progress-info">
                <span id="progressPlatform">í”Œë«í¼</span>
                <span id="progressCount">0ê°œ ìˆ˜ì§‘</span>
            </div>
            <div class="progress-bar-container">
                <div class="progress-bar collecting" id="progressBar"></div>
            </div>
            <div class="progress-status" id="progressStatus">ì´ˆê¸°í™” ì¤‘...</div>
        </div>

        <!-- ìˆ˜ì§‘ ê²°ê³¼ -->
        <div class="card" id="resultsSection" style="display: none;">
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalCount">0</div>
                    <div class="stat-label">ì „ì²´ ë§í¬</div>
                </div>
                <div class="stat-card new">
                    <div class="stat-number" id="newCount">0</div>
                    <div class="stat-label">ìƒˆ ë§í¬</div>
                </div>
                <div class="stat-card submitted">
                    <div class="stat-number" id="submittedCount">0</div>
                    <div class="stat-label">ì œì¶œë¨</div>
                </div>
            </div>

            <div class="filter-tabs">
                <button class="filter-tab active" data-filter="all" onclick="setFilter('all')">
                    ì „ì²´ <span class="filter-count" id="filterAllCount">0</span>
                </button>
                <button class="filter-tab" data-filter="new" onclick="setFilter('new')">
                    ìƒˆ ë§í¬ <span class="filter-count" id="filterNewCount">0</span>
                </button>
                <button class="filter-tab" data-filter="submitted" onclick="setFilter('submitted')">
                    ì œì¶œë¨ <span class="filter-count" id="filterSubmittedCount">0</span>
                </button>
            </div>

            <div class="action-bar">
                <div class="action-info">
                    <strong id="newLinksInfo">0</strong>ê°œì˜ ìƒˆ ë§í¬ë¥¼ ë³µì‚¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
                </div>
                <div class="action-buttons">
                    <button class="btn-success btn-small" onclick="copyNewLinks()">âœ¨ ìƒˆ ë§í¬ ë³µì‚¬</button>
                    <button class="btn-warning btn-small" onclick="copyCurrentPage()">ğŸ“‹ í˜„ì¬ í˜ì´ì§€</button>
                    <button class="btn-primary btn-small" onclick="copyAllLinks()">ğŸ“‘ ì „ì²´ ë³µì‚¬</button>
                    <button class="btn-secondary btn-small" onclick="resetSubmitted()">ğŸ”„ ì´ˆê¸°í™”</button>
                    <button class="btn-danger btn-small" onclick="clearResults()">ğŸ—‘ï¸ ì‚­ì œ</button>
                </div>
            </div>

            <div class="links-container" id="linksContainer">
                <div class="empty-state">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                    </svg>
                    <p>ìˆ˜ì§‘ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                </div>
            </div>

            <div class="pagination" id="pagination" style="display: none;">
                <button class="btn-secondary" onclick="prevPage()">â—€</button>
                <span class="page-info" id="pageInfo">1 / 1</span>
                <button class="btn-secondary" onclick="nextPage()">â–¶</button>
            </div>
        </div>
    </div>

    <!-- ë¸”ë¡œê·¸ ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal-overlay" id="editModal">
        <div class="modal">
            <div class="modal-title">âœï¸ ë¸”ë¡œê·¸ ì •ë³´ ìˆ˜ì •</div>
            <div class="modal-input">
                <label>ë¸”ë¡œê·¸ ì´ë¦„ (ì„ íƒ)</label>
                <input type="text" id="editBlogName" placeholder="ë¸”ë¡œê·¸ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>
            <div class="modal-input">
                <label>ë¸”ë¡œê·¸ URL</label>
                <input type="text" id="editBlogUrl" placeholder="ë¸”ë¡œê·¸ ì£¼ì†Œ">
            </div>
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeEditModal()">ì·¨ì†Œ</button>
                <button class="btn-primary" onclick="saveEditBlog()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- í† ìŠ¤íŠ¸ -->
    <div class="toast" id="toast"></div>

    <script>
        // ==================== ìƒíƒœ ê´€ë¦¬ ====================
        let collectedLinks = [];
        let savedBlogs = JSON.parse(localStorage.getItem('savedBlogs_v4')) || [];
        let submittedLinks = new Set(JSON.parse(localStorage.getItem('submittedLinks_v4')) || []);
        let currentPage = 1;
        let currentFilter = 'all';
        const linksPerPage = 100;
        let isCollecting = false;
        let shouldStop = false;
        let editingBlogIndex = -1;

        // ==================== CORS í”„ë¡ì‹œ ëª©ë¡ ====================
        const PROXIES = [
            {
                name: 'allorigins',
                url: (target) => `https://api.allorigins.win/raw?url=${encodeURIComponent(target)}`
            },
            {
                name: 'corsproxy.io',
                url: (target) => `https://corsproxy.io/?${encodeURIComponent(target)}`
            },
            {
                name: 'cors-anywhere-alt',
                url: (target) => `https://api.codetabs.com/v1/proxy?quest=${encodeURIComponent(target)}`
            }
        ];

        let currentProxyIndex = 0;

        // ==================== í”Œë«í¼ ì„¤ì • ====================
        const PLATFORMS = {
            naver: {
                name: 'ë„¤ì´ë²„ ë¸”ë¡œê·¸',
                color: '#03c75a',
                patterns: [
                    /blog\.naver\.com\/([^\/\?\#]+)/,
                    /m\.blog\.naver\.com\/([^\/\?\#]+)/
                ]
            },
            tistory: {
                name: 'í‹°ìŠ¤í† ë¦¬',
                color: '#eb5311',
                patterns: [
                    /([a-zA-Z0-9-]+)\.tistory\.com/
                ]
            },
            blogger: {
                name: 'ë¸”ë¡œê·¸ìŠ¤íŒŸ',
                color: '#ff5700',
                patterns: [
                    /([a-zA-Z0-9-]+)\.blogspot\.com/
                ]
            }
        };

        // ==================== ì´ˆê¸°í™” ====================
        document.addEventListener('DOMContentLoaded', () => {
            renderBlogList();
            
            const input = document.getElementById('blogUrl');
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addBlog();
            });
            input.addEventListener('input', detectPlatformFromInput);
        });

        // ==================== ë””ë²„ê·¸ ë¡œê·¸ ====================
        function debugLog(message, type = 'info') {
            const debugSection = document.getElementById('debugSection');
            const debugLogEl = document.getElementById('debugLog');
            debugSection.style.display = 'block';
            
            const time = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info';
            debugLogEl.innerHTML += `<div class="${className}">[${time}] ${message}</div>`;
            debugLogEl.scrollTop = debugLogEl.scrollHeight;
        }

        function clearDebugLog() {
            document.getElementById('debugLog').innerHTML = '';
        }

        // ==================== í”„ë¡ì‹œ ìš”ì²­ ====================
        async function fetchWithProxy(url, options = {}) {
            let lastError;
            
            for (let i = 0; i < PROXIES.length; i++) {
                const proxyIndex = (currentProxyIndex + i) % PROXIES.length;
                const proxy = PROXIES[proxyIndex];
                
                try {
                    debugLog(`í”„ë¡ì‹œ ì‹œë„: ${proxy.name}`, 'info');
                    const proxyUrl = proxy.url(url);
                    
                    const response = await fetch(proxyUrl, {
                        ...options,
                        signal: AbortSignal.timeout(15000) // 15ì´ˆ íƒ€ì„ì•„ì›ƒ
                    });
                    
                    if (response.ok) {
                        currentProxyIndex = proxyIndex; // ì„±ê³µí•œ í”„ë¡ì‹œ ê¸°ì–µ
                        debugLog(`${proxy.name} ì„±ê³µ!`, 'info');
                        return response;
                    }
                    
                    throw new Error(`HTTP ${response.status}`);
                } catch (error) {
                    debugLog(`${proxy.name} ì‹¤íŒ¨: ${error.message}`, 'warning');
                    lastError = error;
                }
            }
            
            throw lastError || new Error('ëª¨ë“  í”„ë¡ì‹œ ì‹¤íŒ¨');
        }

        // ==================== í”Œë«í¼ ê°ì§€ ====================
        function detectPlatform(url) {
            url = normalizeUrl(url);
            
            for (const [key, platform] of Object.entries(PLATFORMS)) {
                for (const pattern of platform.patterns) {
                    const match = url.match(pattern);
                    if (match) {
                        return { 
                            type: key, 
                            name: platform.name, 
                            color: platform.color,
                            id: match[1]
                        };
                    }
                }
            }
            return null;
        }

        function detectPlatformFromInput() {
            const input = document.getElementById('blogUrl').value;
            const container = document.getElementById('platformDetect');
            
            if (!input.trim()) {
                container.innerHTML = '';
                return;
            }

            const platform = detectPlatform(input);
            if (platform) {
                container.innerHTML = `
                    <span class="platform-detect" style="background: ${platform.color}15; color: ${platform.color}; border: 2px solid ${platform.color}30;">
                        âœ“ ${platform.name} ê°ì§€ë¨ (${platform.id})
                    </span>
                `;
            } else {
                container.innerHTML = `
                    <span class="platform-detect" style="background: #fee2e2; color: #dc2626;">
                        âš ï¸ ì§€ì›í•˜ì§€ ì•ŠëŠ” í”Œë«í¼ (ë„¤ì´ë²„, í‹°ìŠ¤í† ë¦¬, ë¸”ë¡œê·¸ìŠ¤íŒŸë§Œ ì§€ì›)
                    </span>
                `;
            }
        }

        function normalizeUrl(url) {
            url = url.trim();
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }
            return url.replace(/\/$/, '');
        }

        // ==================== ë¸”ë¡œê·¸ ê´€ë¦¬ ====================
        function addBlog() {
            const input = document.getElementById('blogUrl').value;
            const platform = detectPlatform(input);

            if (!platform) {
                showToast('âŒ ì§€ì›í•˜ì§€ ì•ŠëŠ” í”Œë«í¼ì…ë‹ˆë‹¤');
                return;
            }

            const blogData = {
                url: normalizeUrl(input),
                platform: platform.type,
                name: platform.name,
                id: platform.id,
                customName: ''
            };

            if (savedBlogs.find(b => b.url === blogData.url)) {
                showToast('âš ï¸ ì´ë¯¸ ì €ì¥ëœ ë¸”ë¡œê·¸ì…ë‹ˆë‹¤');
                return;
            }

            savedBlogs.push(blogData);
            localStorage.setItem('savedBlogs_v4', JSON.stringify(savedBlogs));
            document.getElementById('blogUrl').value = '';
            document.getElementById('platformDetect').innerHTML = '';
            renderBlogList();
            showToast('âœ… ë¸”ë¡œê·¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function renderBlogList() {
            const container = document.getElementById('blogList');
            const manager = document.getElementById('blogManager');

            if (savedBlogs.length === 0) {
                manager.style.display = 'none';
                return;
            }

            manager.style.display = 'block';
            
            container.innerHTML = savedBlogs.map((blog, index) => `
                <div class="blog-item">
                    <span class="blog-item-platform ${blog.platform}">${blog.name}</span>
                    <div class="blog-item-info">
                        <div class="blog-item-name">${blog.customName || blog.id}</div>
                        <div class="blog-item-url">${blog.url}</div>
                    </div>
                    <div class="blog-item-actions">
                        <button class="btn-primary btn-small" onclick="selectBlog(${index})">ì„ íƒ</button>
                        <button class="btn-secondary btn-small" onclick="openEditModal(${index})">ìˆ˜ì •</button>
                        <button class="btn-danger btn-small" onclick="removeBlog(${index})">ì‚­ì œ</button>
                    </div>
                </div>
            `).join('');
        }

        function selectBlog(index) {
            document.getElementById('blogUrl').value = savedBlogs[index].url;
            detectPlatformFromInput();
            showToast('ğŸ“Œ ë¸”ë¡œê·¸ê°€ ì„ íƒë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function removeBlog(index) {
            if (confirm('ì´ ë¸”ë¡œê·¸ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                savedBlogs.splice(index, 1);
                localStorage.setItem('savedBlogs_v4', JSON.stringify(savedBlogs));
                renderBlogList();
                showToast('ğŸ—‘ï¸ ë¸”ë¡œê·¸ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
            }
        }

        function openEditModal(index) {
            editingBlogIndex = index;
            const blog = savedBlogs[index];
            document.getElementById('editBlogName').value = blog.customName || '';
            document.getElementById('editBlogUrl').value = blog.url;
            document.getElementById('editModal').classList.add('show');
        }

        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            editingBlogIndex = -1;
        }

        function saveEditBlog() {
            if (editingBlogIndex === -1) return;

            const newName = document.getElementById('editBlogName').value.trim();
            const newUrl = document.getElementById('editBlogUrl').value.trim();
            const platform = detectPlatform(newUrl);

            if (!platform) {
                showToast('âŒ ì§€ì›í•˜ì§€ ì•ŠëŠ” í”Œë«í¼ì…ë‹ˆë‹¤');
                return;
            }

            savedBlogs[editingBlogIndex] = {
                url: normalizeUrl(newUrl),
                platform: platform.type,
                name: platform.name,
                id: platform.id,
                customName: newName
            };

            localStorage.setItem('savedBlogs_v4', JSON.stringify(savedBlogs));
            closeEditModal();
            renderBlogList();
            showToast('âœ… ë¸”ë¡œê·¸ ì •ë³´ê°€ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ==================== ìˆ˜ì§‘ ì œì–´ ====================
        async function startCollect() {
            if (isCollecting) {
                showToast('â³ ì´ë¯¸ ìˆ˜ì§‘ ì¤‘ì…ë‹ˆë‹¤');
                return;
            }

            const input = document.getElementById('blogUrl').value;
            const platform = detectPlatform(input);

            if (!platform) {
                showToast('âŒ ì˜¬ë°”ë¥¸ ë¸”ë¡œê·¸ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }

            isCollecting = true;
            shouldStop = false;
            collectedLinks = [];
            currentPage = 1;
            currentFilter = 'all';
            clearDebugLog();

            // UI ì—…ë°ì´íŠ¸
            document.getElementById('startBtn').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'flex';
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('resultsSection').style.display = 'block';
            document.getElementById('progressBar').style.width = '0%';
            document.getElementById('progressPlatform').textContent = platform.name;
            document.getElementById('progressCount').textContent = '0ê°œ ìˆ˜ì§‘';
            document.getElementById('progressStatus').textContent = 'ì—°ê²° ì¤‘...';

            resetFilterTabs();
            debugLog(`ìˆ˜ì§‘ ì‹œì‘: ${platform.name} (${platform.id})`, 'info');

            try {
                await collectByPlatform(platform, normalizeUrl(input));
                
                if (shouldStop) {
                    showToast(`â¹ ìˆ˜ì§‘ ì¤‘ì§€ë¨ (${collectedLinks.length}ê°œ ìˆ˜ì§‘)`);
                    debugLog(`ìˆ˜ì§‘ ì¤‘ì§€ë¨: ${collectedLinks.length}ê°œ`, 'warning');
                } else {
                    const newCount = collectedLinks.filter(l => !l.submitted).length;
                    showToast(`âœ… ìˆ˜ì§‘ ì™„ë£Œ! ì´ ${collectedLinks.length}ê°œ (ìƒˆ ë§í¬: ${newCount}ê°œ)`);
                    debugLog(`ìˆ˜ì§‘ ì™„ë£Œ: ì´ ${collectedLinks.length}ê°œ, ìƒˆ ë§í¬ ${newCount}ê°œ`, 'info');
                }
            } catch (error) {
                console.error(error);
                showToast('âŒ ìˆ˜ì§‘ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
                debugLog(`ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
            } finally {
                isCollecting = false;
                shouldStop = false;
                document.getElementById('startBtn').style.display = 'flex';
                document.getElementById('stopBtn').style.display = 'none';
                document.getElementById('progressSection').style.display = 'none';
                document.getElementById('progressBar').classList.remove('collecting');
            }
        }

        function stopCollect() {
            if (isCollecting) {
                shouldStop = true;
                document.getElementById('progressStatus').textContent = 'ì •ì§€ ì¤‘...';
                debugLog('ìˆ˜ì§‘ ì •ì§€ ìš”ì²­ë¨', 'warning');
                showToast('â¹ ìˆ˜ì§‘ì„ ì •ì§€í•©ë‹ˆë‹¤...');
            }
        }

        // ==================== í”Œë«í¼ë³„ ìˆ˜ì§‘ ====================
        async function collectByPlatform(platform, url) {
            switch (platform.type) {
                case 'naver':
                    await collectNaverBlog(platform.id);
                    break;
                case 'tistory':
                    await collectTistory(platform.id, url);
                    break;
                case 'blogger':
                    await collectBlogger(url);
                    break;
            }

            renderLinks();
            updateStats();
        }

        // ========== ë„¤ì´ë²„ ë¸”ë¡œê·¸ ==========
        async function collectNaverBlog(blogId) {
            debugLog(`ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìˆ˜ì§‘ ì‹œì‘: ${blogId}`, 'info');
            
            let page = 1;
            let hasMore = true;
            let consecutiveErrors = 0;
            const maxPages = 500;

            while (hasMore && !shouldStop && page <= maxPages) {
                try {
                    updateProgress(collectedLinks.length, `í˜ì´ì§€ ${page} ìˆ˜ì§‘ ì¤‘...`);
                    
                    // ë„¤ì´ë²„ ë¸”ë¡œê·¸ API ì§ì ‘ í˜¸ì¶œ ì‹œë„
                    const apiUrl = `https://blog.naver.com/PostTitleListAsync.naver?blogId=${blogId}&currentPage=${page}&countPerPage=30`;
                    
                    debugLog(`API ìš”ì²­: í˜ì´ì§€ ${page}`, 'info');
                    const response = await fetchWithProxy(apiUrl);
                    const text = await response.text();
                    
                    let foundCount = 0;

                    // JSON íŒŒì‹± ì‹œë„
                    try {
                        // ë„¤ì´ë²„ ì‘ë‹µì€ íŠ¹ìˆ˜í•œ í˜•ì‹ì¼ ìˆ˜ ìˆìŒ
                        const data = JSON.parse(text);
                        
                        if (data.postList && Array.isArray(data.postList) && data.postList.length > 0) {
                            data.postList.forEach(post => {
                                const postUrl = `https://blog.naver.com/${blogId}/${post.logNo}`;
                                if (!collectedLinks.find(l => l.url === postUrl)) {
                                    collectedLinks.push({
                                        url: postUrl,
                                        platform: 'naver',
                                        submitted: submittedLinks.has(postUrl)
                                    });
                                    foundCount++;
                                }
                            });
                            debugLog(`í˜ì´ì§€ ${page}: ${foundCount}ê°œ ë°œê²¬ (JSON)`, 'info');
                            hasMore = data.postList.length >= 30;
                        } else {
                            debugLog(`í˜ì´ì§€ ${page}: ë” ì´ìƒ ê²Œì‹œë¬¼ ì—†ìŒ`, 'info');
                            hasMore = false;
                        }
                    } catch (jsonError) {
                        // JSON íŒŒì‹± ì‹¤íŒ¨ ì‹œ HTMLì—ì„œ ì¶”ì¶œ
                        debugLog(`JSON íŒŒì‹± ì‹¤íŒ¨, HTML íŒŒì‹± ì‹œë„`, 'warning');
                        
                        // logNo íŒ¨í„´ ì¶”ì¶œ
                        const logNoPattern = /logNo['":\s]+(\d+)/g;
                        const matches = [...text.matchAll(logNoPattern)];
                        
                        if (matches.length > 0) {
                            const uniqueLogNos = [...new Set(matches.map(m => m[1]))];
                            uniqueLogNos.forEach(logNo => {
                                const postUrl = `https://blog.naver.com/${blogId}/${logNo}`;
                                if (!collectedLinks.find(l => l.url === postUrl)) {
                                    collectedLinks.push({
                                        url: postUrl,
                                        platform: 'naver',
                                        submitted: submittedLinks.has(postUrl)
                                    });
                                    foundCount++;
                                }
                            });
                            debugLog(`í˜ì´ì§€ ${page}: ${foundCount}ê°œ ë°œê²¬ (HTML)`, 'info');
                            hasMore = uniqueLogNos.length >= 25;
                        } else {
                            // ë‹¤ë¥¸ íŒ¨í„´ ì‹œë„
                            const hrefPattern = /\/([a-zA-Z0-9_-]+)\/(\d{10,})/g;
                            const hrefMatches = [...text.matchAll(hrefPattern)];
                            
                            hrefMatches.forEach(match => {
                                if (match[1] === blogId) {
                                    const postUrl = `https://blog.naver.com/${blogId}/${match[2]}`;
                                    if (!collectedLinks.find(l => l.url === postUrl)) {
                                        collectedLinks.push({
                                            url: postUrl,
                                            platform: 'naver',
                                            submitted: submittedLinks.has(postUrl)
                                        });
                                        foundCount++;
                                    }
                                }
                            });
                            
                            if (foundCount > 0) {
                                debugLog(`í˜ì´ì§€ ${page}: ${foundCount}ê°œ ë°œê²¬ (href íŒ¨í„´)`, 'info');
                            }
                            
                            hasMore = foundCount > 0;
                        }
                    }

                    if (foundCount === 0 && page > 1) {
                        consecutiveErrors++;
                        if (consecutiveErrors >= 2) {
                            debugLog('ì—°ì† 2íšŒ ìˆ˜ì§‘ ì‹¤íŒ¨, ì¢…ë£Œ', 'warning');
                            hasMore = false;
                        }
                    } else {
                        consecutiveErrors = 0;
                    }

                    page++;
                    await sleep(500);

                } catch (error) {
                    debugLog(`í˜ì´ì§€ ${page} ì˜¤ë¥˜: ${error.message}`, 'error');
                    consecutiveErrors++;
                    if (consecutiveErrors >= 3) {
                        debugLog('ì—°ì† 3íšŒ ì˜¤ë¥˜, ìˆ˜ì§‘ ì¢…ë£Œ', 'error');
                        hasMore = false;
                    }
                    await sleep(1500);
                }
            }

            // ê²°ê³¼ê°€ ì—†ìœ¼ë©´ ë¸”ë¡œê·¸ ë©”ì¸ í˜ì´ì§€ì—ì„œ ì§ì ‘ ìˆ˜ì§‘ ì‹œë„
            if (collectedLinks.length === 0) {
                debugLog('API ìˆ˜ì§‘ ì‹¤íŒ¨, ë¸”ë¡œê·¸ ë©”ì¸ í˜ì´ì§€ í¬ë¡¤ë§ ì‹œë„', 'warning');
                await crawlNaverBlogMain(blogId);
            }
        }

        async function crawlNaverBlogMain(blogId) {
            try {
                const mainUrl = `https://blog.naver.com/PostList.naver?blogId=${blogId}&from=postList&categoryNo=0`;
                debugLog(`ë©”ì¸ í˜ì´ì§€ í¬ë¡¤ë§: ${mainUrl}`, 'info');
                
                const response = await fetchWithProxy(mainUrl);
                const html = await response.text();
                
                // ë‹¤ì–‘í•œ íŒ¨í„´ìœ¼ë¡œ í¬ìŠ¤íŠ¸ ID ì¶”ì¶œ
                const patterns = [
                    /logNo=(\d+)/g,
                    /\/(\d{10,})(?:\?|"|'|$)/g,
                    /postId['":\s]+['"]?(\d+)/g
                ];

                const foundIds = new Set();
                
                for (const pattern of patterns) {
                    const matches = [...html.matchAll(pattern)];
                    matches.forEach(match => {
                        if (match[1] && match[1].length >= 10) {
                            foundIds.add(match[1]);
                        }
                    });
                }

                foundIds.forEach(logNo => {
                    const postUrl = `https://blog.naver.com/${blogId}/${logNo}`;
                    if (!collectedLinks.find(l => l.url === postUrl)) {
                        collectedLinks.push({
                            url: postUrl,
                            platform: 'naver',
                            submitted: submittedLinks.has(postUrl)
                        });
                    }
                });

                debugLog(`ë©”ì¸ í˜ì´ì§€ì—ì„œ ${foundIds.size}ê°œ ë°œê²¬`, 'info');
            } catch (error) {
                debugLog(`ë©”ì¸ í˜ì´ì§€ í¬ë¡¤ë§ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ========== í‹°ìŠ¤í† ë¦¬ ==========
        async function collectTistory(blogId, baseUrl) {
            debugLog(`í‹°ìŠ¤í† ë¦¬ ìˆ˜ì§‘ ì‹œì‘: ${blogId}`, 'info');
            
            // 1. RSS í”¼ë“œ ì‹œë„
            try {
                debugLog('RSS í”¼ë“œ ìˆ˜ì§‘ ì‹œë„...', 'info');
                updateProgress(0, 'RSS í”¼ë“œ ìˆ˜ì§‘ ì¤‘...');
                await collectFromRSS(`${baseUrl}/rss`, 'tistory');
                debugLog(`RSS ìˆ˜ì§‘ ì™„ë£Œ: ${collectedLinks.length}ê°œ`, 'info');
            } catch (e) {
                debugLog(`RSS ì‹¤íŒ¨: ${e.message}`, 'warning');
            }

            if (shouldStop) return;

            // 2. ì‚¬ì´íŠ¸ë§µ ì‹œë„
            if (collectedLinks.length < 100) {
                try {
                    debugLog('ì‚¬ì´íŠ¸ë§µ ìˆ˜ì§‘ ì‹œë„...', 'info');
                    updateProgress(collectedLinks.length, 'ì‚¬ì´íŠ¸ë§µ ìˆ˜ì§‘ ì¤‘...');
                    await collectFromSitemap(`${baseUrl}/sitemap.xml`, 'tistory', baseUrl);
                    debugLog(`ì‚¬ì´íŠ¸ë§µ ìˆ˜ì§‘ í›„: ${collectedLinks.length}ê°œ`, 'info');
                } catch (e) {
                    debugLog(`ì‚¬ì´íŠ¸ë§µ ì‹¤íŒ¨: ${e.message}`, 'warning');
                }
            }

            if (shouldStop) return;

            // 3. í˜ì´ì§€ í¬ë¡¤ë§
            if (collectedLinks.length < 50) {
                debugLog('í˜ì´ì§€ í¬ë¡¤ë§ ì‹œë„...', 'info');
                await crawlTistoryPages(baseUrl);
            }
        }

        async function crawlTistoryPages(baseUrl) {
            let page = 1;
            let consecutiveEmpty = 0;

            while (!shouldStop && page <= 100 && consecutiveEmpty < 3) {
                try {
                    updateProgress(collectedLinks.length, `í˜ì´ì§€ ${page} í¬ë¡¤ë§ ì¤‘...`);
                    
                    const pageUrl = `${baseUrl}/?page=${page}`;
                    debugLog(`í¬ë¡¤ë§: ${pageUrl}`, 'info');
                    
                    const response = await fetchWithProxy(pageUrl);
                    const html = await response.text();
                    
                    let foundCount = 0;
                    
                    // í‹°ìŠ¤í† ë¦¬ í¬ìŠ¤íŠ¸ URL íŒ¨í„´ë“¤
                    const patterns = [
                        new RegExp(`href=["'](${baseUrl.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')}/(\\d+))["']`, 'g'),
                        new RegExp(`href=["']/(\\d+)["']`, 'g'),
                        new RegExp(`href=["'](https?://[^"']*tistory\\.com/(\\d+))["']`, 'g'),
                        /href=["']([^"']*\/entry\/[^"']+)["']/g
                    ];

                    for (const pattern of patterns) {
                        let match;
                        while ((match = pattern.exec(html)) !== null) {
                            let postUrl = match[1];
                            
                            // ìƒëŒ€ ê²½ë¡œ ì²˜ë¦¬
                            if (postUrl.startsWith('/')) {
                                postUrl = baseUrl + postUrl;
                            }
                            
                            // ìˆ«ìë¡œë§Œ ëœ ê²½ìš°
                            if (/^\d+$/.test(postUrl)) {
                                postUrl = `${baseUrl}/${postUrl}`;
                            }

                            // ìœ íš¨í•œ í¬ìŠ¤íŠ¸ URLì¸ì§€ í™•ì¸
                            if (postUrl.includes(baseUrl) || postUrl.includes('tistory.com')) {
                                // ì œì™¸í•  URL íŒ¨í„´
                                if (!postUrl.includes('/category/') && 
                                    !postUrl.includes('/tag/') && 
                                    !postUrl.includes('/guestbook') &&
                                    !postUrl.includes('/notice/') &&
                                    !postUrl.includes('?page=') &&
                                    !postUrl.includes('#')) {
                                    
                                    if (!collectedLinks.find(l => l.url === postUrl)) {
                                        collectedLinks.push({
                                            url: postUrl,
                                            platform: 'tistory',
                                            submitted: submittedLinks.has(postUrl)
                                        });
                                        foundCount++;
                                    }
                                }
                            }
                        }
                    }

                    debugLog(`í˜ì´ì§€ ${page}: ${foundCount}ê°œ ë°œê²¬`, 'info');
                    
                    if (foundCount === 0) {
                        consecutiveEmpty++;
                    } else {
                        consecutiveEmpty = 0;
                    }

                    page++;
                    await sleep(600);

                } catch (error) {
                    debugLog(`í˜ì´ì§€ ${page} í¬ë¡¤ë§ ì˜¤ë¥˜: ${error.message}`, 'error');
                    consecutiveEmpty++;
                    await sleep(1000);
                }
            }
        }

        // ========== ë¸”ë¡œê·¸ìŠ¤íŒŸ ==========
        async function collectBlogger(baseUrl) {
            debugLog(`ë¸”ë¡œê·¸ìŠ¤íŒŸ ìˆ˜ì§‘ ì‹œì‘: ${baseUrl}`, 'info');
            
            // 1. Atom í”¼ë“œ ì‹œë„ (ë¸”ë¡œê·¸ìŠ¤íŒŸ ê¸°ë³¸)
            try {
                debugLog('Atom í”¼ë“œ ìˆ˜ì§‘ ì‹œë„...', 'info');
                updateProgress(0, 'Atom í”¼ë“œ ìˆ˜ì§‘ ì¤‘...');
                await collectFromAtom(`${baseUrl}/feeds/posts/default?max-results=500`, 'blogger');
                debugLog(`Atom ìˆ˜ì§‘ ì™„ë£Œ: ${collectedLinks.length}ê°œ`, 'info');
            } catch (e) {
                debugLog(`Atom ì‹¤íŒ¨: ${e.message}`, 'warning');
            }

            if (shouldStop) return;

            // 2. RSS í”¼ë“œ ì‹œë„
            if (collectedLinks.length === 0) {
                try {
                    debugLog('RSS í”¼ë“œ ìˆ˜ì§‘ ì‹œë„...', 'info');
                    updateProgress(0, 'RSS í”¼ë“œ ìˆ˜ì§‘ ì¤‘...');
                    await collectFromRSS(`${baseUrl}/feeds/posts/default?alt=rss&max-results=500`, 'blogger');
                    debugLog(`RSS ìˆ˜ì§‘ ì™„ë£Œ: ${collectedLinks.length}ê°œ`, 'info');
                } catch (e) {
                    debugLog(`RSS ì‹¤íŒ¨: ${e.message}`, 'warning');
                }
            }

            if (shouldStop) return;

            // 3. ì‚¬ì´íŠ¸ë§µ ì‹œë„
            if (collectedLinks.length < 50) {
                try {
                    debugLog('ì‚¬ì´íŠ¸ë§µ ìˆ˜ì§‘ ì‹œë„...', 'info');
                    updateProgress(collectedLinks.length, 'ì‚¬ì´íŠ¸ë§µ ìˆ˜ì§‘ ì¤‘...');
                    await collectFromSitemap(`${baseUrl}/sitemap.xml`, 'blogger', baseUrl);
                    debugLog(`ì‚¬ì´íŠ¸ë§µ ìˆ˜ì§‘ í›„: ${collectedLinks.length}ê°œ`, 'info');
                } catch (e) {
                    debugLog(`ì‚¬ì´íŠ¸ë§µ ì‹¤íŒ¨: ${e.message}`, 'warning');
                }
            }

            if (shouldStop) return;

            // 4. ë©”ì¸ í˜ì´ì§€ í¬ë¡¤ë§
            if (collectedLinks.length < 30) {
                debugLog('ë©”ì¸ í˜ì´ì§€ í¬ë¡¤ë§ ì‹œë„...', 'info');
                await crawlBloggerMain(baseUrl);
            }
        }

        async function crawlBloggerMain(baseUrl) {
            try {
                updateProgress(collectedLinks.length, 'ë¸”ë¡œê·¸ í˜ì´ì§€ í¬ë¡¤ë§ ì¤‘...');
                
                const response = await fetchWithProxy(baseUrl);
                const html = await response.text();
                
                // ë¸”ë¡œê·¸ìŠ¤íŒŸ í¬ìŠ¤íŠ¸ URL íŒ¨í„´
                const patterns = [
                    /href=["'](https?:\/\/[^"']*blogspot\.com\/\d{4}\/\d{2}\/[^"']+\.html)["']/g,
                    /href=["'](\/\d{4}\/\d{2}\/[^"']+\.html)["']/g
                ];

                let foundCount = 0;

                for (const pattern of patterns) {
                    let match;
                    while ((match = pattern.exec(html)) !== null) {
                        let postUrl = match[1];
                        
                        if (postUrl.startsWith('/')) {
                            postUrl = baseUrl + postUrl;
                        }

                        if (!collectedLinks.find(l => l.url === postUrl)) {
                            collectedLinks.push({
                                url: postUrl,
                                platform: 'blogger',
                                submitted: submittedLinks.has(postUrl)
                            });
                            foundCount++;
                        }
                    }
                }

                debugLog(`ë©”ì¸ í˜ì´ì§€ì—ì„œ ${foundCount}ê°œ ë°œê²¬`, 'info');
            } catch (error) {
                debugLog(`ë©”ì¸ í˜ì´ì§€ í¬ë¡¤ë§ ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        // ==================== ê³µí†µ ìˆ˜ì§‘ í•¨ìˆ˜ ====================
        async function collectFromRSS(rssUrl, platform) {
            const response = await fetchWithProxy(rssUrl);
            const text = await response.text();
            
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, 'text/xml');
            
            // íŒŒì‹± ì˜¤ë¥˜ ì²´í¬
            const parseError = xml.querySelector('parsererror');
            if (parseError) {
                throw new Error('RSS íŒŒì‹± ì˜¤ë¥˜');
            }

            let count = 0;

            // RSS 2.0 ì•„ì´í…œ
            xml.querySelectorAll('item').forEach(item => {
                const linkEl = item.querySelector('link');
                let url = linkEl?.textContent?.trim();
                
                // CDATA ì²˜ë¦¬
                if (!url) {
                    const linkHtml = item.innerHTML;
                    const linkMatch = linkHtml.match(/<link[^>]*>([^<]+)<\/link>/i);
                    if (linkMatch) url = linkMatch[1].trim();
                }

                if (url && !collectedLinks.find(l => l.url === url)) {
                    collectedLinks.push({
                        url,
                        platform,
                        submitted: submittedLinks.has(url)
                    });
                    count++;
                }
            });

            // Atom ì—”íŠ¸ë¦¬
            xml.querySelectorAll('entry').forEach(entry => {
                const linkEl = entry.querySelector('link[rel="alternate"]') || entry.querySelector('link');
                const url = linkEl?.getAttribute('href');
                if (url && !collectedLinks.find(l => l.url === url)) {
                    collectedLinks.push({
                        url,
                        platform,
                        submitted: submittedLinks.has(url)
                    });
                    count++;
                }
            });

            debugLog(`RSS/Atomì—ì„œ ${count}ê°œ ì¶”ì¶œ`, 'info');
            updateProgress(collectedLinks.length, 'RSS ìˆ˜ì§‘ ì™„ë£Œ');
        }

        async function collectFromAtom(atomUrl, platform) {
            const response = await fetchWithProxy(atomUrl);
            const text = await response.text();
            
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, 'text/xml');
            
            let count = 0;

            xml.querySelectorAll('entry').forEach(entry => {
                // alternate ë§í¬ ìš°ì„ 
                let linkEl = entry.querySelector('link[rel="alternate"]');
                if (!linkEl) {
                    linkEl = entry.querySelector('link:not([rel="self"]):not([rel="edit"])');
                }
                
                const url = linkEl?.getAttribute('href');
                if (url && !collectedLinks.find(l => l.url === url)) {
                    collectedLinks.push({
                        url,
                        platform,
                        submitted: submittedLinks.has(url)
                    });
                    count++;
                }
            });

            debugLog(`Atomì—ì„œ ${count}ê°œ ì¶”ì¶œ`, 'info');
            updateProgress(collectedLinks.length, 'Atom ìˆ˜ì§‘ ì™„ë£Œ');
        }

        async function collectFromSitemap(sitemapUrl, platform, baseUrl) {
            const response = await fetchWithProxy(sitemapUrl);
            const text = await response.text();
            
            const parser = new DOMParser();
            const xml = parser.parseFromString(text, 'text/xml');
            
            // ì‚¬ì´íŠ¸ë§µ ì¸ë±ìŠ¤ í™•ì¸
            const sitemapLocs = xml.querySelectorAll('sitemap loc');
            if (sitemapLocs.length > 0) {
                debugLog(`ì‚¬ì´íŠ¸ë§µ ì¸ë±ìŠ¤ ë°œê²¬: ${sitemapLocs.length}ê°œ í•˜ìœ„ ì‚¬ì´íŠ¸ë§µ`, 'info');
                for (const loc of sitemapLocs) {
                    if (shouldStop) break;
                    try {
                        await collectFromSitemap(loc.textContent.trim(), platform, baseUrl);
                        await sleep(400);
                    } catch (e) {
                        debugLog(`í•˜ìœ„ ì‚¬ì´íŠ¸ë§µ ì˜¤ë¥˜: ${e.message}`, 'warning');
                    }
                }
                return;
            }
            
            // URL ì¶”ì¶œ
            let count = 0;
            xml.querySelectorAll('url loc').forEach(el => {
                const url = el.textContent?.trim();
                if (url && !collectedLinks.find(l => l.url === url)) {
                    // í•„í„°ë§
                    if (!url.includes('/category/') && 
                        !url.includes('/tag/') && 
                        !url.includes('/page/') &&
                        !url.includes('/search/') &&
                        !url.includes('/archive/') &&
                        !url.includes('/label/') &&
                        !url.endsWith('/')) {
                        
                        collectedLinks.push({
                            url,
                            platform,
                            submitted: submittedLinks.has(url)
                        });
                        count++;
                    }
                }
            });

            debugLog(`ì‚¬ì´íŠ¸ë§µì—ì„œ ${count}ê°œ ì¶”ì¶œ`, 'info');
            updateProgress(collectedLinks.length, 'ì‚¬ì´íŠ¸ë§µ ìˆ˜ì§‘ ì¤‘...');
        }

        // ==================== UI ì—…ë°ì´íŠ¸ ====================
        function updateProgress(count, status) {
            const progress = Math.min((count / 100) * 100, 95);
            document.getElementById('progressBar').style.width = progress + '%';
            document.getElementById('progressCount').textContent = `${count}ê°œ ìˆ˜ì§‘`;
            document.getElementById('progressStatus').textContent = status;
        }

        function updateStats() {
            const total = collectedLinks.length;
            const submitted = collectedLinks.filter(l => l.submitted).length;
            const newLinks = total - submitted;

            document.getElementById('totalCount').textContent = total;
            document.getElementById('newCount').textContent = newLinks;
            document.getElementById('submittedCount').textContent = submitted;
            document.getElementById('newLinksInfo').textContent = newLinks;

            document.getElementById('filterAllCount').textContent = total;
            document.getElementById('filterNewCount').textContent = newLinks;
            document.getElementById('filterSubmittedCount').textContent = submitted;
        }

        function resetFilterTabs() {
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.filter === 'all') tab.classList.add('active');
            });
        }

        function setFilter(filter) {
            currentFilter = filter;
            currentPage = 1;

            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.filter === filter);
            });

            renderLinks();
        }

        function getFilteredLinks() {
            switch (currentFilter) {
                case 'new': return collectedLinks.filter(l => !l.submitted);
                case 'submitted': return collectedLinks.filter(l => l.submitted);
                default: return collectedLinks;
            }
        }

        function renderLinks() {
            const container = document.getElementById('linksContainer');
            const filteredLinks = getFilteredLinks();
            const totalCount = filteredLinks.length;
            const totalPages = Math.ceil(totalCount / linksPerPage);

            const platformNames = {
                naver: 'ë„¤ì´ë²„',
                tistory: 'í‹°ìŠ¤í† ë¦¬',
                blogger: 'ë¸”ë¡œê·¸ìŠ¤íŒŸ'
            };

            if (totalCount === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                        </svg>
                        <p>${currentFilter === 'new' ? 'ìƒˆ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤' : currentFilter === 'submitted' ? 'ì œì¶œëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤' : 'ìˆ˜ì§‘ëœ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤'}</p>
                    </div>
                `;
                document.getElementById('pagination').style.display = 'none';
                return;
            }

            const start = (currentPage - 1) * linksPerPage;
            const end = Math.min(start + linksPerPage, totalCount);
            const pageLinks = filteredLinks.slice(start, end);

            container.innerHTML = pageLinks.map((link, index) => `
                <div class="link-item ${link.submitted ? 'submitted' : ''}">
                    <div class="link-number">${start + index + 1}</div>
                    <div class="link-content">
                        <div class="link-url">
                            <a href="${link.url}" target="_blank">${link.url}</a>
                        </div>
                        <div class="link-platform">${platformNames[link.platform]}</div>
                    </div>
                    <div class="link-status">
                        <span class="status-badge ${link.submitted ? 'submitted' : 'new'}">
                            ${link.submitted ? 'âœ“ ì œì¶œë¨' : 'â— ìƒˆ ë§í¬'}
                        </span>
                    </div>
                </div>
            `).join('');

            document.getElementById('pagination').style.display = totalPages > 1 ? 'flex' : 'none';
            document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
        }

        // ==================== í˜ì´ì§€ë„¤ì´ì…˜ ====================
        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                renderLinks();
            }
        }

        function nextPage() {
            const totalPages = Math.ceil(getFilteredLinks().length / linksPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderLinks();
            }
        }

        // ==================== ë³µì‚¬ ê¸°ëŠ¥ ====================
        function copyNewLinks() {
            const newLinks = collectedLinks.filter(l => !l.submitted);

            if (newLinks.length === 0) {
                showToast('âš ï¸ ë³µì‚¬í•  ìƒˆ ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            const urls = newLinks.map(l => l.url);
            copyToClipboard(urls.join('\n'));

            newLinks.forEach(link => {
                link.submitted = true;
                submittedLinks.add(link.url);
            });

            localStorage.setItem('submittedLinks_v4', JSON.stringify([...submittedLinks]));
            renderLinks();
            updateStats();
            showToast(`âœ… ${urls.length}ê°œì˜ ìƒˆ ë§í¬ ë³µì‚¬ ì™„ë£Œ`);
        }

        function copyCurrentPage() {
            const filteredLinks = getFilteredLinks();
            const start = (currentPage - 1) * linksPerPage;
            const end = Math.min(start + linksPerPage, filteredLinks.length);
            const pageLinks = filteredLinks.slice(start, end);

            if (pageLinks.length === 0) {
                showToast('âš ï¸ ë³µì‚¬í•  ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            const urls = pageLinks.map(l => l.url);
            copyToClipboard(urls.join('\n'));

            pageLinks.forEach(link => {
                link.submitted = true;
                submittedLinks.add(link.url);
            });

            localStorage.setItem('submittedLinks_v4', JSON.stringify([...submittedLinks]));
            renderLinks();
            updateStats();
            showToast(`âœ… ${urls.length}ê°œ ë§í¬ ë³µì‚¬ ì™„ë£Œ`);
        }

        function copyAllLinks() {
            if (collectedLinks.length === 0) {
                showToast('âš ï¸ ë³µì‚¬í•  ë§í¬ê°€ ì—†ìŠµë‹ˆë‹¤');
                return;
            }

            const urls = collectedLinks.map(l => l.url);
            copyToClipboard(urls.join('\n'));

            collectedLinks.forEach(link => {
                link.submitted = true;
                submittedLinks.add(link.url);
            });

            localStorage.setItem('submittedLinks_v4', JSON.stringify([...submittedLinks]));
            renderLinks();
            updateStats();
            showToast(`âœ… ${urls.length}ê°œ ì „ì²´ ë§í¬ ë³µì‚¬ ì™„ë£Œ`);
        }

        async function copyToClipboard(text) {
            try {
                await navigator.clipboard.writeText(text);
            } catch {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }
        }

        // ==================== ì´ˆê¸°í™” ====================
        function resetSubmitted() {
            collectedLinks.forEach(link => link.submitted = false);
            submittedLinks.clear();
            localStorage.setItem('submittedLinks_v4', JSON.stringify([]));
            renderLinks();
            updateStats();
            showToast('ğŸ”„ ì œì¶œ ìƒíƒœê°€ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        function clearResults() {
            collectedLinks = [];
            currentPage = 1;
            renderLinks();
            updateStats();
            showToast('ğŸ—‘ï¸ ìˆ˜ì§‘ ê²°ê³¼ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
        }

        // ==================== ìœ í‹¸ë¦¬í‹° ====================
        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3500);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
